---
title: "reg_logistic"
author : "Joanna"
format: html

---


# Setup

```{r setup}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(readxl)
library(ggplot2)
library(gmodels)
library(lme4)
```

# Appel des bases de données nécessaires 


```{r chargement du fichier "lac"}
lac <- read.csv2("generated_datasets/lac.csv")
```

# Première régression logistique pour la décision de mise à la reproduction 

```{r création de 8 classes de parité}
lac <- lac |> 
  mutate(C8parity = case_when(parity == 1 ~ "1",
                            parity == 2 ~ "2",
                            parity == 3 ~ "3",
                            parity == 4 ~ "4",
                            parity == 5 ~ "5",
                            parity == 6 ~ "6",
                            parity == 7 ~ "7",
                            parity == 8 ~ "8 et plus",
                            TRUE~NA))
```


```{r : régrssion logistique, premier essai}
myreg_miserepro <- glmer(miserepro ~ n_early_chronic_scc + n_early_brief_scc + n_early_mam_cl + factor(C8parity) + early_milk + (1 | herd_id), 
                    family= binomial(link = "logit"), data = lac)
summary(myreg_miserepro)
```

Commentaire de Joanna : j'ai pour l'instant décidé d'utiliser seulement 3 types de mammites différentes car il m'est difficile d'associer les épisodes cliniques avec les scc. Pour l'instant on constate que les mam_cl et les pics de scc > 200 ne sont pas du tout significatifs dans le modèle. *

Il faudrait également prendre en compte le nombre de génisses disponibles et en attente pour le renouvellement du troupeau. 

bilan de la première régression : 
on constate qu'il ne semble pas y avoir de lien prouvé entre la présence d'une mammite clinique ou d'un pic fugace de cellules en début de lactation et la décision de mise à la reproduction. 

# deuxième régression logistique : impact des mammites sur la mort 

```{r création de la variable mort ou non}
lac <- lac |> 
  group_by(herd_id, anim_id) |> 
  mutate(mort = ifelse(out_cause == "M" & parity == max(parity), 1, 0))
```

```{r régression logistique}
myreg_mort <- glmer(mort ~ n_chronic_scc + n_brief_scc + n_mam_cl + factor(C8parity) + mean_milk + (1 | herd_id), 
                    family= binomial(link = "logit"), data = lac)
summary(myreg_mort)
```
pas logique...la parité n'aurait pas de lien, ni les mammites cliniques mais la prodution laitière oui....ce modèle me semble non exploitable

# troisième régression logistique : impact des mammites sur la production laitière moyenne 

Ici il faudrait prendre en compte la saison, l'alimentation, la suvenue de troubles métaboliques en début de lactation, etc...mais ce sont des informations que l'on a pas. On peut émettre l'hypothèse que ce sont des variables non observées mais qui touchent toutes les vaches avec la même proba...(pas tout a fait vrai)
Il est impossible de faire une régression logistique sur la PL seule car ce n'est pas une varable binaire...

